apiVersion: v1
kind: ConfigMap
metadata:
  name: app-config
data:
  # Hardcoded secrets in ConfigMap (should use Secrets)
  database_password: "SuperSecretPassword123!"
  api_key: "sk-1234567890abcdefghijklmnopqrstuvwxyz"
  aws_access_key: "AKIAI44QH8DHBEXAMPLE"
  aws_secret_key: "je7MtGbClwBF/2Zp9Utk/h3yCo8nvbEXAMPLEKEY"

---
apiVersion: v1
kind: Pod
metadata:
  name: vulnerable-app
  labels:
    app: vulnerable-app
spec:
  # Running as root user
  securityContext:
    runAsUser: 0
    runAsNonRoot: false
    
  # Privileged container
  containers:
  - name: app
    image: vulnerable-app:latest  # Using latest tag
    
    # Privileged mode enabled
    securityContext:
      privileged: true
      allowPrivilegeEscalation: true
      readOnlyRootFilesystem: false
      runAsNonRoot: false
      capabilities:
        add:
          - SYS_ADMIN
          - NET_ADMIN
          - ALL
    
    # No resource limits
    # resources:
    #   limits:
    #     memory: "128Mi"
    #     cpu: "500m"
    
    # Exposing host network
    hostNetwork: true
    hostPID: true
    hostIPC: true
    
    # Mounting sensitive host paths
    volumeMounts:
    - name: docker-socket
      mountPath: /var/run/docker.sock
    - name: host-root
      mountPath: /host
    
    # Environment variables with secrets
    env:
    - name: DB_PASSWORD
      value: "MyDatabasePassword123!"
    - name: API_KEY
      value: "sk-proj-abcdef1234567890"
    
    ports:
    - containerPort: 80
      protocol: TCP
      
  volumes:
  - name: docker-socket
    hostPath:
      path: /var/run/docker.sock
  - name: host-root
    hostPath:
      path: /

---
apiVersion: v1
kind: Service
metadata:
  name: vulnerable-service
spec:
  type: LoadBalancer  # Exposing to internet
  ports:
  - port: 80
    targetPort: 80
  selector:
    app: vulnerable-app

---
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  name: overly-permissive-role
rules:
# Overly permissive RBAC - grants all permissions
- apiGroups: ["*"]
  resources: ["*"]
  verbs: ["*"]

---
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRoleBinding
metadata:
  name: overly-permissive-binding
subjects:
- kind: ServiceAccount
  name: default
  namespace: default
roleRef:
  kind: ClusterRole
  name: overly-permissive-role
  apiGroup: rbac.authorization.k8s.io

---
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: allow-all-policy
spec:
  # Allows all ingress and egress traffic
  podSelector: {}
  policyTypes:
  - Ingress
  - Egress
  ingress:
  - from:
    - podSelector: {}
  egress:
  - to:
    - podSelector: {}

# Missing security best practices:
# - No PodSecurityPolicy/PodSecurityStandards
# - No AppArmor/SELinux profiles
# - No network policies restricting traffic
# - No admission controllers
# - No image pull policy
# - No liveness/readiness probes
# - No pod disruption budget
# - No resource quotas
